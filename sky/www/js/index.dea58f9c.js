import{_ as st,m as ut,I as ct,z as ft,a as pt,b as dt,c as yt,r as mt,d as _t}from"../index.js";/* empty css              */import{c as vt,l as ht,T as gt,d as bt,a as xt,r as wt,i as St}from"./index.a0d0d184.js";/* empty css               *//* empty css              *//* empty css               *//* empty css              */import{c as kt,r as I,f as Tt,J as D,aO as Q,aP as s,N as C,l as c,aZ as Z,a_ as k,K as G,u as W,F as Et,b3 as Ct,b4 as tt,aT as ot,b5 as zt,b6 as $t,b7 as At,b8 as Ot,aY as at,b9 as Pt,ba as Nt,bb as Lt,bc as rt,bd as It,p as Dt,aX as Mt,be as Rt,an as jt,bf as Ft,bg as Bt,n as Kt}from"./arco.73db23e5.js";import{u as it}from"./loading.a8216e84.js";import{u as lt}from"./vue.57427092.js";import"./vendor.7cd83524.js";var Vt={exports:{}};/*!
 * clipboard.js v2.0.11
 * https://clipboardjs.com/
 *
 * Licensed MIT Â© Zeno Rocha
 */(function(O,U){(function(E,z){O.exports=z()})(kt,function(){return function(){var N={686:function(_,a,e){e.d(a,{default:function(){return nt}});var p=e(279),o=e.n(p),d=e(370),y=e.n(d),h=e(817),T=e.n(h);function m(u){try{return document.execCommand(u)}catch{return!1}}var w=function(t){var n=T()(t);return m("cut"),n},i=w;function b(u){var t=document.documentElement.getAttribute("dir")==="rtl",n=document.createElement("textarea");n.style.fontSize="12pt",n.style.border="0",n.style.padding="0",n.style.margin="0",n.style.position="absolute",n.style[t?"right":"left"]="-9999px";var l=window.pageYOffset||document.documentElement.scrollTop;return n.style.top="".concat(l,"px"),n.setAttribute("readonly",""),n.value=u,n}var F=function(t,n){var l=b(t);n.container.appendChild(l);var f=T()(l);return m("copy"),l.remove(),f},B=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{container:document.body},l="";return typeof t=="string"?l=F(t,n):t instanceof HTMLInputElement&&!["text","search","url","tel","password"].includes(t==null?void 0:t.type)?l=F(t.value,n):(l=T()(t),m("copy")),l},M=B;function L(u){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?L=function(n){return typeof n}:L=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},L(u)}var j=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=t.action,l=n===void 0?"copy":n,f=t.container,v=t.target,P=t.text;if(l!=="copy"&&l!=="cut")throw new Error('Invalid "action" value, use either "copy" or "cut"');if(v!==void 0)if(v&&L(v)==="object"&&v.nodeType===1){if(l==="copy"&&v.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if(l==="cut"&&(v.hasAttribute("readonly")||v.hasAttribute("disabled")))throw new Error(`Invalid "target" attribute. You can't cut text from elements with "readonly" or "disabled" attributes`)}else throw new Error('Invalid "target" value, use a valid Element');if(P)return M(P,{container:f});if(v)return l==="cut"?i(v):M(v,{container:f})},q=j;function R(u){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?R=function(n){return typeof n}:R=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},R(u)}function H(u,t){if(!(u instanceof t))throw new TypeError("Cannot call a class as a function")}function Y(u,t){for(var n=0;n<t.length;n++){var l=t[n];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(u,l.key,l)}}function r(u,t,n){return t&&Y(u.prototype,t),n&&Y(u,n),u}function S(u,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");u.prototype=Object.create(t&&t.prototype,{constructor:{value:u,writable:!0,configurable:!0}}),t&&g(u,t)}function g(u,t){return g=Object.setPrototypeOf||function(l,f){return l.__proto__=f,l},g(u,t)}function $(u){var t=K();return function(){var l=V(u),f;if(t){var v=V(this).constructor;f=Reflect.construct(l,arguments,v)}else f=l.apply(this,arguments);return x(this,f)}}function x(u,t){return t&&(R(t)==="object"||typeof t=="function")?t:A(u)}function A(u){if(u===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u}function K(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function V(u){return V=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},V(u)}function J(u,t){var n="data-clipboard-".concat(u);if(!!t.hasAttribute(n))return t.getAttribute(n)}var et=function(u){S(n,u);var t=$(n);function n(l,f){var v;return H(this,n),v=t.call(this),v.resolveOptions(f),v.listenClick(l),v}return r(n,[{key:"resolveOptions",value:function(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.action=typeof f.action=="function"?f.action:this.defaultAction,this.target=typeof f.target=="function"?f.target:this.defaultTarget,this.text=typeof f.text=="function"?f.text:this.defaultText,this.container=R(f.container)==="object"?f.container:document.body}},{key:"listenClick",value:function(f){var v=this;this.listener=y()(f,"click",function(P){return v.onClick(P)})}},{key:"onClick",value:function(f){var v=f.delegateTarget||f.currentTarget,P=this.action(v)||"copy",X=q({action:P,container:this.container,target:this.target(v),text:this.text(v)});this.emit(X?"success":"error",{action:P,text:X,trigger:v,clearSelection:function(){v&&v.focus(),window.getSelection().removeAllRanges()}})}},{key:"defaultAction",value:function(f){return J("action",f)}},{key:"defaultTarget",value:function(f){var v=J("target",f);if(v)return document.querySelector(v)}},{key:"defaultText",value:function(f){return J("text",f)}},{key:"destroy",value:function(){this.listener.destroy()}}],[{key:"copy",value:function(f){var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{container:document.body};return M(f,v)}},{key:"cut",value:function(f){return i(f)}},{key:"isSupported",value:function(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:["copy","cut"],v=typeof f=="string"?[f]:f,P=!!document.queryCommandSupported;return v.forEach(function(X){P=P&&!!document.queryCommandSupported(X)}),P}}]),n}(o()),nt=et},828:function(_){var a=9;if(typeof Element<"u"&&!Element.prototype.matches){var e=Element.prototype;e.matches=e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector}function p(o,d){for(;o&&o.nodeType!==a;){if(typeof o.matches=="function"&&o.matches(d))return o;o=o.parentNode}}_.exports=p},438:function(_,a,e){var p=e(828);function o(h,T,m,w,i){var b=y.apply(this,arguments);return h.addEventListener(m,b,i),{destroy:function(){h.removeEventListener(m,b,i)}}}function d(h,T,m,w,i){return typeof h.addEventListener=="function"?o.apply(null,arguments):typeof m=="function"?o.bind(null,document).apply(null,arguments):(typeof h=="string"&&(h=document.querySelectorAll(h)),Array.prototype.map.call(h,function(b){return o(b,T,m,w,i)}))}function y(h,T,m,w){return function(i){i.delegateTarget=p(i.target,T),i.delegateTarget&&w.call(h,i)}}_.exports=d},879:function(_,a){a.node=function(e){return e!==void 0&&e instanceof HTMLElement&&e.nodeType===1},a.nodeList=function(e){var p=Object.prototype.toString.call(e);return e!==void 0&&(p==="[object NodeList]"||p==="[object HTMLCollection]")&&"length"in e&&(e.length===0||a.node(e[0]))},a.string=function(e){return typeof e=="string"||e instanceof String},a.fn=function(e){var p=Object.prototype.toString.call(e);return p==="[object Function]"}},370:function(_,a,e){var p=e(879),o=e(438);function d(m,w,i){if(!m&&!w&&!i)throw new Error("Missing required arguments");if(!p.string(w))throw new TypeError("Second argument must be a String");if(!p.fn(i))throw new TypeError("Third argument must be a Function");if(p.node(m))return y(m,w,i);if(p.nodeList(m))return h(m,w,i);if(p.string(m))return T(m,w,i);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function y(m,w,i){return m.addEventListener(w,i),{destroy:function(){m.removeEventListener(w,i)}}}function h(m,w,i){return Array.prototype.forEach.call(m,function(b){b.addEventListener(w,i)}),{destroy:function(){Array.prototype.forEach.call(m,function(b){b.removeEventListener(w,i)})}}}function T(m,w,i){return o(document.body,m,w,i)}_.exports=d},817:function(_){function a(e){var p;if(e.nodeName==="SELECT")e.focus(),p=e.value;else if(e.nodeName==="INPUT"||e.nodeName==="TEXTAREA"){var o=e.hasAttribute("readonly");o||e.setAttribute("readonly",""),e.select(),e.setSelectionRange(0,e.value.length),o||e.removeAttribute("readonly"),p=e.value}else{e.hasAttribute("contenteditable")&&e.focus();var d=window.getSelection(),y=document.createRange();y.selectNodeContents(e),d.removeAllRanges(),d.addRange(y),p=d.toString()}return p}_.exports=a},279:function(_){function a(){}a.prototype={on:function(e,p,o){var d=this.e||(this.e={});return(d[e]||(d[e]=[])).push({fn:p,ctx:o}),this},once:function(e,p,o){var d=this;function y(){d.off(e,y),p.apply(o,arguments)}return y._=p,this.on(e,y,o)},emit:function(e){var p=[].slice.call(arguments,1),o=((this.e||(this.e={}))[e]||[]).slice(),d=0,y=o.length;for(d;d<y;d++)o[d].fn.apply(o[d].ctx,p);return this},off:function(e,p){var o=this.e||(this.e={}),d=o[e],y=[];if(d&&p)for(var h=0,T=d.length;h<T;h++)d[h].fn!==p&&d[h].fn._!==p&&y.push(d[h]);return y.length?o[e]=y:delete o[e],this}},_.exports=a,_.exports.TinyEmitter=a}},E={};function z(_){if(E[_])return E[_].exports;var a=E[_]={exports:{}};return N[_](a,a.exports,z),a.exports}return function(){z.n=function(_){var a=_&&_.__esModule?function(){return _.default}:function(){return _};return z.d(a,{a}),a}}(),function(){z.d=function(_,a){for(var e in a)z.o(a,e)&&!z.o(_,e)&&Object.defineProperty(_,e,{enumerable:!0,get:a[e]})}}(),function(){z.o=function(_,a){return Object.prototype.hasOwnProperty.call(_,a)}}(),z(686)}().default})})(Vt);const Ut=O=>{if(isNaN(O))return"0 bytes";const U=["bytes","KB","MB","GB","TB","PB","EB","ZB","YB"];let N=Math.floor(Math.log(O)/Math.log(2));N<1&&(N=0);const E=Math.floor(N/10);return O/=2**(10*E),O.toString().length>O.toFixed(2).toString().length&&(O=O.toFixed(2)),`${O} ${U[E]}`};const qt={class:"frame-bg"},Ht={class:"frame-body"},Yt={class:"frame-aside"},Zt={class:"frame-main"},Gt={key:0,class:"main-content"},Jt={style:{"font-size":"15px"}},Xt={style:{"font-size":"15px"}},Qt={key:1,class:"main-content"},Wt={style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},te={style:{display:"flex",alignItems:"center",color:"#1D2129"}},ee={__name:"port-form",emits:["ok"],setup(O,{expose:U,emit:N}){const{t:E}=lt(),{loading:z,setLoading:_}=it(),a=I(!1),e=I({zone_id:"",zone_name:"",protocol:"trojan"}),p=N,o=I(1),d=Tt(()=>o.value==1?E("port.next"):E("port.complete")),y=I({port:null,ip:null,protocol:null}),h=I([]),T=async()=>{try{_(!0);const{data:i}=await ft();h.value=i.map(b=>({zone_id:b.zone_id,zone_name:b.zone_name}))}catch{}finally{_(!1)}},m=async()=>{if(o.value==1){if(!e.value.zone_id)return ot.error(E("port.select.zone")),!0;try{const{data:i}=await vt({zone_id:e.value.zone_id,protocol:e.value.protocol,proxy_users:[]});y.value=i;const{data:b}=await ut();y.value.ip=b.ip,o.value=2}catch{}}else e.value={zone_id:null,zone_name:null,protocol:"trojan"},a.value=!1,p("ok");return!0};return U({open:async()=>{T(),o.value=1,e.value={zone_id:null,zone_name:null,protocol:"trojan"},a.value=!0}}),(i,b)=>{const F=zt,B=$t,M=At,L=Ot,j=at,q=Pt,R=ct,H=Nt,Y=Lt,r=rt,S=It;return D(),Q(S,{visible:a.value,title:i.$t("port.create"),"unmount-on-close":"","mask-closable":!1,width:"550px","ok-text":d.value,"ok-loading":W(z),"hide-cancel":"","on-before-ok":m,onCancel:b[2]||(b[2]=g=>a.value=!1)},{default:s(()=>[C("div",qt,[C("div",Ht,[C("div",Yt,[c(B,{current:o.value,direction:"vertical"},{default:s(()=>[c(F,null,{default:s(()=>[Z(k(i.$t("port.zone.select")),1)]),_:1}),c(F,null,{default:s(()=>[Z(k(i.$t("port.complete.create")),1)]),_:1})]),_:1},8,["current"])]),C("div",Zt,[o.value===1?(D(),G("div",Gt,[c(j,{direction:"vertical",fill:"",style:{"margin-bottom":"11px"}},{default:s(()=>[C("span",Jt,k(i.$t("port.proxy.protocol")),1),c(L,{modelValue:e.value.protocol,"onUpdate:modelValue":b[0]||(b[0]=g=>e.value.protocol=g),style:{width:"320px"},placeholder:i.$t("port.select.proxy.protocol")},{default:s(()=>[c(M,{label:"Skyproxy",value:"trojan"}),c(M,{label:"Socks5/HTTP(s)",value:"mixed"})]),_:1},8,["modelValue","placeholder"])]),_:1}),c(j,{direction:"vertical",fill:""},{default:s(()=>[C("span",Xt,k(i.$t("port.zone.name")),1),c(L,{modelValue:e.value.zone_id,"onUpdate:modelValue":b[1]||(b[1]=g=>e.value.zone_id=g),style:{width:"320px"},placeholder:i.$t("port.select.zone"),loading:W(z)},{default:s(()=>[(D(!0),G(Et,null,Ct(h.value,(g,$)=>(D(),Q(M,{key:$,label:g.zone_name,value:g.zone_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading"])]),_:1})])):tt("",!0),o.value===2?(D(),G("div",Qt,[c(j,{direction:"vertical",fill:""},{default:s(()=>[C("span",null,[Z(k(i.$t("port.port.created"))+" ",1),c(q,{color:"green"},{default:s(()=>[Z(k(y.value.port),1)]),_:1})]),c(r,{hoverable:"",style:{width:"340px"}},{default:s(()=>[c(j,{direction:"vertical",fill:""},{default:s(()=>[C("span",null,k(i.$t("port.run.command")),1),C("div",Wt,[C("span",te,[c(H,{style:{marginRight:"8px",backgroundColor:"#165DFF"},size:25},{default:s(()=>[c(R)]),_:1}),c(Y,{copyable:""},{default:s(()=>[Z(k(y.value.protocol)+"://"+k(y.value.ip)+":"+k(y.value.port),1)]),_:1})])])]),_:1})]),_:1})]),_:1})])):tt("",!0)])])])]),_:1},8,["visible","title","ok-text","ok-loading"])}}},ne=st(ee,[["__scopeId","data-v-94150d25"]]);const oe={style:{padding:"22px"}},ae={key:0},re={key:1},he={__name:"index",setup(O,{expose:U}){const{loading:N,setLoading:E}=it(),{pageSize:z}=_t(),_=I(null),{t:a}=lt(),e=I({pageSize:z,total:0,current:1,showTotal:!0,showJumper:!0,showPageSize:!0,pageSizeOptions:[15,30,50,100,200]}),p=r=>r?` / ${r}`:"",o=I([]),d=I([]),y=r=>Object.keys(r).includes("children")?"cell":"children",h=[{title:()=>a("table.port.internal_name"),dataIndex:"internal_name",slotName:"internal_name",align:"center",ellipsis:!0,tooltip:!0,bodyCellClass:y},{title:()=>a("table.proxy.port"),dataIndex:"port",slotName:"port",align:"center",ellipsis:!0,tooltip:!0,bodyCellClass:y},{title:()=>a("table.proxy.status"),dataIndex:"status",slotName:"status",align:"center",ellipsis:!0,tooltip:!0,bodyCellClass:y},{title:()=>a("table.proxy.zone_name"),dataIndex:"zone_name",slotName:"zone_name",align:"center",ellipsis:!0,tooltip:!0,bodyCellClass:y},{title:()=>a("table.proxy.position"),dataIndex:"position",slotName:"position",align:"center",ellipsis:!0,tooltip:!0,bodyCellClass:y},{title:()=>a("table.proxy.request"),dataIndex:"request",slotName:"request",align:"center",ellipsis:!0,tooltip:!0,bodyCellClass:y},{title:()=>a("table.proxy.flow"),dataIndex:"flow",slotName:"flow",align:"center",ellipsis:!0,tooltip:!0,bodyCellClass:y},{title:()=>a("table.proxy.operation"),align:"center",slotName:"oper",width:220,bodyCellClass:y}],T=I([]),m=async(r=null)=>{try{E(!0);const{data:S}=await ht({page:r,limit:e.value.pageSize}),{list:g,total:$}=S,x=[];g.forEach(A=>{A.multiply>0?x.push({...A,isLeaf:!1}):x.push({...A,isLeaf:!0})}),T.value=x,e.value.current=r,e.value.total=$}catch{}finally{E(!1)}},w=(r,S)=>{E(!0),Kt(async()=>{try{if(d.value.includes(r)){const{data:$}=await xt({pid:S.id}),x=[];$.forEach(A=>{x.push({...A,isLeaf:!0,disabled:!0})}),S.children=x}else S.children=null}catch{}finally{E(!1)}})},i=Dt({type:"checkbox",showCheckedAll:!0,onlyCurrent:!0});m(1);const b=r=>{m(r)},F=r=>{e.value.pageSize=r,m(1)},B=()=>{T.value=[],m(1)},M=()=>{_.value.open()},L=async r=>{try{E(!0),await bt({ids:r}),ot.success(a("table.proxy.message.success.del")),B()}catch{}finally{E(!1)}},j=async()=>{o.value.length>0&&(await L([...o.value]),o.value=[])},q=r=>{mt.push({name:"PortSetting",query:{id:r}})},R=r=>{r.isLeaf!=!0&&q(r.id)},H=async r=>{var $;let S=[r];(($=r==null?void 0:r.children)==null?void 0:$.length)>0&&(S=S.concat(r.children));const g=async x=>{try{x.status="Testing";const{data:A}=await wt({id:x.id});x.status=A.status;const{data:K}=await St({id:x.id});x.request=K.request,x.flow=K.flow}catch{r.status="Fail"}};S.forEach(x=>{g(x)})},Y=async()=>{o.value.length>0&&T.value.forEach(async r=>{o.value.includes(r.id)&&H(r)})};return U({getTableData:m}),(r,S)=>{const g=Mt,$=pt,x=Rt,A=jt,K=Ft,V=at,J=dt,et=yt,nt=Bt,u=rt;return D(),G("div",oe,[c(u,null,{default:s(()=>[c(gt,{style:{"margin-bottom":"16px"}},{right:s(()=>[c(x,{content:r.$t("table.list.refresh")},{default:s(()=>[c(g,{type:"outline",shape:"circle",onClick:B},{default:s(()=>[c(J)]),_:1})]),_:1},8,["content"])]),default:s(()=>[c(V,null,{default:s(()=>[c(g,{type:"primary",shape:"round",onClick:M},{default:s(()=>[Z(k(r.$t("table.port.create")),1)]),_:1}),c(x,{content:r.$t("table.port.create")},{default:s(()=>[c(g,{type:"text",onClick:Y},{default:s(()=>[c($,{size:20})]),_:1})]),_:1},8,["content"]),c(x,{content:r.$t("table.port.del")},{default:s(()=>[c(K,{content:r.$t("table.port.confirm.del"),position:"bottom",onOk:j},{default:s(()=>[c(g,{type:"text"},{default:s(()=>[c(A,{size:20})]),_:1})]),_:1},8,["content"])]),_:1},8,["content"])]),_:1})]),_:1}),c(nt,{selectedKeys:o.value,"onUpdate:selectedKeys":S[0]||(S[0]=t=>o.value=t),expandedKeys:d.value,"onUpdate:expandedKeys":S[1]||(S[1]=t=>d.value=t),loading:W(N),columns:h,data:T.value,"row-key":"id","row-selection":i,pagination:e.value,"load-more":(t,n)=>{n()},onExpand:w,onPageChange:b,onPageSizeChange:F,onCellDblclick:R},{internal_name:s(({record:t})=>[C("div",null,k(t.internal_name?t.internal_name:"--"),1)]),port:s(({record:t})=>[c(V,null,{default:s(()=>[c(x,{content:r.$t("table.list.refresh")},{default:s(()=>[c(g,{type:"text",disabled:t.status=="Testing",onClick:n=>H(t)},{default:s(()=>[c($)]),_:2},1032,["disabled","onClick"])]),_:2},1032,["content"]),C("div",null,[t.multiply>0?(D(),G("span",ae,k(t.port)+" ["+k(t.multiply)+"] ",1)):(D(),G("span",re,k(t.port),1))])]),_:2},1024)]),status:s(({record:t})=>[C("div",null,k(t.status?t.status:"--"),1)]),zone_name:s(({record:t})=>[C("div",null,k(t.zone_name),1)]),position:s(({record:t})=>[C("div",null,k(!t.area&&!t.state&&!t.city?r.$t("table.list.refresh"):t.area+p(t.state)+p(t.city)),1)]),request:s(({record:t})=>[C("div",null,k(t.request),1)]),flow:s(({record:t})=>[C("div",null,k(W(Ut)(t.flow)),1)]),oper:s(({record:t})=>[c(x,{content:r.$t("table.port.del")},{default:s(()=>[c(K,{content:r.$t("table.port.assign.del"),onOk:n=>L([t.id])},{default:s(()=>[t.pid==0?(D(),Q(g,{key:0,type:"text"},{default:s(()=>[c(A)]),_:1})):tt("",!0)]),_:2},1032,["content","onOk"])]),_:2},1032,["content"]),c(x,{content:r.$t("table.port.setting")},{default:s(()=>[t.pid==0?(D(),Q(g,{key:0,type:"text",onClick:n=>q(t.id)},{default:s(()=>[c(et)]),_:2},1032,["onClick"])):tt("",!0)]),_:2},1032,["content"])]),_:1},8,["selectedKeys","expandedKeys","loading","data","row-selection","pagination","load-more"])]),_:1}),c(ne,{ref_key:"formRef",ref:_,onOk:B},null,512)])}}};export{he as default};
