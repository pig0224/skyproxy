import{_ as st,m as ut,I as ct,z as ft,a as pt,b as dt,c as yt,r as _t,d as mt}from"../index.js";/* empty css              */import{c as vt,l as ht,T as gt,d as bt,a as xt,r as wt,i as St}from"./index.b72705a9.js";/* empty css               *//* empty css              *//* empty css               *//* empty css              */import{c as Et,r as R,f as kt,J as D,aO as tt,aP as s,N as C,l as c,aZ as G,a_ as w,K as J,u as et,F as Tt,b3 as Ct,b4 as nt,aT as ot,b5 as zt,b6 as $t,b7 as At,b8 as Ot,aY as at,b9 as Pt,ba as Nt,bb as Lt,bc as rt,bd as It,p as Mt,aX as Rt,be as Dt,an as jt,bf as Ft,bg as Bt,n as Ut}from"./arco.73db23e5.js";import{u as it}from"./loading.a8216e84.js";import{u as lt}from"./vue.57427092.js";import"./vendor.7cd83524.js";var Kt={exports:{}};/*!
 * clipboard.js v2.0.11
 * https://clipboardjs.com/
 *
 * Licensed MIT Â© Zeno Rocha
 */(function(O,H){(function(k,$){O.exports=$()})(Et,function(){return function(){var I={686:function(m,a,e){e.d(a,{default:function(){return q}});var p=e(279),o=e.n(p),d=e(370),y=e.n(d),g=e(817),S=e.n(g);function _(l){try{return document.execCommand(l)}catch{return!1}}var x=function(t){var n=S()(t);return _("cut"),n},i=x;function b(l){var t=document.documentElement.getAttribute("dir")==="rtl",n=document.createElement("textarea");n.style.fontSize="12pt",n.style.border="0",n.style.padding="0",n.style.margin="0",n.style.position="absolute",n.style[t?"right":"left"]="-9999px";var u=window.pageYOffset||document.documentElement.scrollTop;return n.style.top="".concat(u,"px"),n.setAttribute("readonly",""),n.value=l,n}var K=function(t,n){var u=b(t);n.container.appendChild(u);var f=S()(u);return _("copy"),u.remove(),f},V=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{container:document.body},u="";return typeof t=="string"?u=K(t,n):t instanceof HTMLInputElement&&!["text","search","url","tel","password"].includes(t==null?void 0:t.type)?u=K(t.value,n):(u=S()(t),_("copy")),u},j=V;function M(l){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?M=function(n){return typeof n}:M=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},M(l)}var B=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=t.action,u=n===void 0?"copy":n,f=t.container,v=t.target,L=t.text;if(u!=="copy"&&u!=="cut")throw new Error('Invalid "action" value, use either "copy" or "cut"');if(v!==void 0)if(v&&M(v)==="object"&&v.nodeType===1){if(u==="copy"&&v.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if(u==="cut"&&(v.hasAttribute("readonly")||v.hasAttribute("disabled")))throw new Error(`Invalid "target" attribute. You can't cut text from elements with "readonly" or "disabled" attributes`)}else throw new Error('Invalid "target" value, use a valid Element');if(L)return j(L,{container:f});if(v)return u==="cut"?i(v):j(v,{container:f})},Q=B;function F(l){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?F=function(n){return typeof n}:F=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},F(l)}function Y(l,t){if(!(l instanceof t))throw new TypeError("Cannot call a class as a function")}function X(l,t){for(var n=0;n<t.length;n++){var u=t[n];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(l,u.key,u)}}function r(l,t,n){return t&&X(l.prototype,t),n&&X(l,n),l}function T(l,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");l.prototype=Object.create(t&&t.prototype,{constructor:{value:l,writable:!0,configurable:!0}}),t&&h(l,t)}function h(l,t){return h=Object.setPrototypeOf||function(u,f){return u.__proto__=f,u},h(l,t)}function A(l){var t=Z();return function(){var u=N(l),f;if(t){var v=N(this).constructor;f=Reflect.construct(u,arguments,v)}else f=u.apply(this,arguments);return E(this,f)}}function E(l,t){return t&&(F(t)==="object"||typeof t=="function")?t:P(l)}function P(l){if(l===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return l}function Z(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function N(l){return N=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},N(l)}function U(l,t){var n="data-clipboard-".concat(l);if(!!t.hasAttribute(n))return t.getAttribute(n)}var z=function(l){T(n,l);var t=A(n);function n(u,f){var v;return Y(this,n),v=t.call(this),v.resolveOptions(f),v.listenClick(u),v}return r(n,[{key:"resolveOptions",value:function(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.action=typeof f.action=="function"?f.action:this.defaultAction,this.target=typeof f.target=="function"?f.target:this.defaultTarget,this.text=typeof f.text=="function"?f.text:this.defaultText,this.container=F(f.container)==="object"?f.container:document.body}},{key:"listenClick",value:function(f){var v=this;this.listener=y()(f,"click",function(L){return v.onClick(L)})}},{key:"onClick",value:function(f){var v=f.delegateTarget||f.currentTarget,L=this.action(v)||"copy",W=Q({action:L,container:this.container,target:this.target(v),text:this.text(v)});this.emit(W?"success":"error",{action:L,text:W,trigger:v,clearSelection:function(){v&&v.focus(),window.getSelection().removeAllRanges()}})}},{key:"defaultAction",value:function(f){return U("action",f)}},{key:"defaultTarget",value:function(f){var v=U("target",f);if(v)return document.querySelector(v)}},{key:"defaultText",value:function(f){return U("text",f)}},{key:"destroy",value:function(){this.listener.destroy()}}],[{key:"copy",value:function(f){var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{container:document.body};return j(f,v)}},{key:"cut",value:function(f){return i(f)}},{key:"isSupported",value:function(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:["copy","cut"],v=typeof f=="string"?[f]:f,L=!!document.queryCommandSupported;return v.forEach(function(W){L=L&&!!document.queryCommandSupported(W)}),L}}]),n}(o()),q=z},828:function(m){var a=9;if(typeof Element<"u"&&!Element.prototype.matches){var e=Element.prototype;e.matches=e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector}function p(o,d){for(;o&&o.nodeType!==a;){if(typeof o.matches=="function"&&o.matches(d))return o;o=o.parentNode}}m.exports=p},438:function(m,a,e){var p=e(828);function o(g,S,_,x,i){var b=y.apply(this,arguments);return g.addEventListener(_,b,i),{destroy:function(){g.removeEventListener(_,b,i)}}}function d(g,S,_,x,i){return typeof g.addEventListener=="function"?o.apply(null,arguments):typeof _=="function"?o.bind(null,document).apply(null,arguments):(typeof g=="string"&&(g=document.querySelectorAll(g)),Array.prototype.map.call(g,function(b){return o(b,S,_,x,i)}))}function y(g,S,_,x){return function(i){i.delegateTarget=p(i.target,S),i.delegateTarget&&x.call(g,i)}}m.exports=d},879:function(m,a){a.node=function(e){return e!==void 0&&e instanceof HTMLElement&&e.nodeType===1},a.nodeList=function(e){var p=Object.prototype.toString.call(e);return e!==void 0&&(p==="[object NodeList]"||p==="[object HTMLCollection]")&&"length"in e&&(e.length===0||a.node(e[0]))},a.string=function(e){return typeof e=="string"||e instanceof String},a.fn=function(e){var p=Object.prototype.toString.call(e);return p==="[object Function]"}},370:function(m,a,e){var p=e(879),o=e(438);function d(_,x,i){if(!_&&!x&&!i)throw new Error("Missing required arguments");if(!p.string(x))throw new TypeError("Second argument must be a String");if(!p.fn(i))throw new TypeError("Third argument must be a Function");if(p.node(_))return y(_,x,i);if(p.nodeList(_))return g(_,x,i);if(p.string(_))return S(_,x,i);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function y(_,x,i){return _.addEventListener(x,i),{destroy:function(){_.removeEventListener(x,i)}}}function g(_,x,i){return Array.prototype.forEach.call(_,function(b){b.addEventListener(x,i)}),{destroy:function(){Array.prototype.forEach.call(_,function(b){b.removeEventListener(x,i)})}}}function S(_,x,i){return o(document.body,_,x,i)}m.exports=d},817:function(m){function a(e){var p;if(e.nodeName==="SELECT")e.focus(),p=e.value;else if(e.nodeName==="INPUT"||e.nodeName==="TEXTAREA"){var o=e.hasAttribute("readonly");o||e.setAttribute("readonly",""),e.select(),e.setSelectionRange(0,e.value.length),o||e.removeAttribute("readonly"),p=e.value}else{e.hasAttribute("contenteditable")&&e.focus();var d=window.getSelection(),y=document.createRange();y.selectNodeContents(e),d.removeAllRanges(),d.addRange(y),p=d.toString()}return p}m.exports=a},279:function(m){function a(){}a.prototype={on:function(e,p,o){var d=this.e||(this.e={});return(d[e]||(d[e]=[])).push({fn:p,ctx:o}),this},once:function(e,p,o){var d=this;function y(){d.off(e,y),p.apply(o,arguments)}return y._=p,this.on(e,y,o)},emit:function(e){var p=[].slice.call(arguments,1),o=((this.e||(this.e={}))[e]||[]).slice(),d=0,y=o.length;for(d;d<y;d++)o[d].fn.apply(o[d].ctx,p);return this},off:function(e,p){var o=this.e||(this.e={}),d=o[e],y=[];if(d&&p)for(var g=0,S=d.length;g<S;g++)d[g].fn!==p&&d[g].fn._!==p&&y.push(d[g]);return y.length?o[e]=y:delete o[e],this}},m.exports=a,m.exports.TinyEmitter=a}},k={};function $(m){if(k[m])return k[m].exports;var a=k[m]={exports:{}};return I[m](a,a.exports,$),a.exports}return function(){$.n=function(m){var a=m&&m.__esModule?function(){return m.default}:function(){return m};return $.d(a,{a}),a}}(),function(){$.d=function(m,a){for(var e in a)$.o(a,e)&&!$.o(m,e)&&Object.defineProperty(m,e,{enumerable:!0,get:a[e]})}}(),function(){$.o=function(m,a){return Object.prototype.hasOwnProperty.call(m,a)}}(),$(686)}().default})})(Kt);const Vt=O=>{if(isNaN(O))return"0 bytes";const H=["bytes","KB","MB","GB","TB","PB","EB","ZB","YB"];let I=Math.floor(Math.log(O)/Math.log(2));I<1&&(I=0);const k=Math.floor(I/10);return O/=2**(10*k),O.toString().length>O.toFixed(2).toString().length&&(O=O.toFixed(2)),`${O} ${H[k]}`};const qt={class:"frame-bg"},Ht={class:"frame-body"},Qt={class:"frame-aside"},Yt={class:"frame-main"},Xt={key:0,class:"main-content"},Zt={style:{"font-size":"15px"}},Gt={style:{"font-size":"15px"}},Jt={key:1,class:"main-content"},Wt={style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},te={style:{display:"flex",alignItems:"center",color:"#1D2129"}},ee={__name:"port-form",emits:["ok"],setup(O,{expose:H,emit:I}){const{t:k}=lt(),{loading:$,setLoading:m}=it(),a=R(!1),e=R({zone_id:"",zone_name:"",protocol:"trojan"}),p=I,o=R(1),d=kt(()=>o.value==1?k("port.next"):k("port.complete")),y=R({port:null,ip:null,protocol:null}),g=R([]),S=async()=>{try{m(!0);const{data:i}=await ft();g.value=i.map(b=>({zone_id:b.zone_id,zone_name:b.zone_name}))}catch{}finally{m(!1)}},_=async()=>{if(o.value==1){if(!e.value.zone_id)return ot.error(k("port.select.zone")),!0;try{const{data:i}=await vt({zone_id:e.value.zone_id,protocol:e.value.protocol,proxy_users:[]});y.value=i;const{data:b}=await ut();y.value.ip=b.ip,o.value=2}catch{}}else e.value={zone_id:null,zone_name:null,protocol:"trojan"},a.value=!1,p("ok");return!0};return H({open:async()=>{S(),o.value=1,e.value={zone_id:null,zone_name:null,protocol:"trojan"},a.value=!0}}),(i,b)=>{const K=zt,V=$t,j=At,M=Ot,B=at,Q=Pt,F=ct,Y=Nt,X=Lt,r=rt,T=It;return D(),tt(T,{visible:a.value,title:i.$t("port.create"),"unmount-on-close":"","mask-closable":!1,width:"550px","ok-text":d.value,"ok-loading":et($),"hide-cancel":"","on-before-ok":_,onCancel:b[2]||(b[2]=h=>a.value=!1)},{default:s(()=>[C("div",qt,[C("div",Ht,[C("div",Qt,[c(V,{current:o.value,direction:"vertical"},{default:s(()=>[c(K,null,{default:s(()=>[G(w(i.$t("port.zone.select")),1)]),_:1}),c(K,null,{default:s(()=>[G(w(i.$t("port.complete.create")),1)]),_:1})]),_:1},8,["current"])]),C("div",Yt,[o.value===1?(D(),J("div",Xt,[c(B,{direction:"vertical",fill:"",style:{"margin-bottom":"11px"}},{default:s(()=>[C("span",Zt,w(i.$t("port.proxy.protocol")),1),c(M,{modelValue:e.value.protocol,"onUpdate:modelValue":b[0]||(b[0]=h=>e.value.protocol=h),style:{width:"320px"},placeholder:i.$t("port.select.proxy.protocol")},{default:s(()=>[c(j,{label:"Skyproxy",value:"trojan"}),c(j,{label:"Socks5/HTTP(s)",value:"mixed"})]),_:1},8,["modelValue","placeholder"])]),_:1}),c(B,{direction:"vertical",fill:""},{default:s(()=>[C("span",Gt,w(i.$t("port.zone.name")),1),c(M,{modelValue:e.value.zone_id,"onUpdate:modelValue":b[1]||(b[1]=h=>e.value.zone_id=h),style:{width:"320px"},placeholder:i.$t("port.select.zone"),loading:et($)},{default:s(()=>[(D(!0),J(Tt,null,Ct(g.value,(h,A)=>(D(),tt(j,{key:A,label:h.zone_name,value:h.zone_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading"])]),_:1})])):nt("",!0),o.value===2?(D(),J("div",Jt,[c(B,{direction:"vertical",fill:""},{default:s(()=>[C("span",null,[G(w(i.$t("port.port.created"))+" ",1),c(Q,{color:"green"},{default:s(()=>[G(w(y.value.port),1)]),_:1})]),c(r,{hoverable:"",style:{width:"340px"}},{default:s(()=>[c(B,{direction:"vertical",fill:""},{default:s(()=>[C("span",null,w(i.$t("port.run.command")),1),C("div",Wt,[C("span",te,[c(Y,{style:{marginRight:"8px",backgroundColor:"#165DFF"},size:25},{default:s(()=>[c(F)]),_:1}),c(X,{copyable:""},{default:s(()=>[G(w(y.value.protocol)+"://"+w(y.value.ip)+":"+w(y.value.port),1)]),_:1})])])]),_:1})]),_:1})]),_:1})])):nt("",!0)])])])]),_:1},8,["visible","title","ok-text","ok-loading"])}}},ne=st(ee,[["__scopeId","data-v-94150d25"]]);const oe={style:{padding:"22px"}},ae={key:0},re={key:1},he={__name:"index",setup(O,{expose:H}){const{loading:I,setLoading:k}=it(),{pageSize:$}=mt(),m=R(null),{t:a}=lt(),e=R({pageSize:$,total:0,current:1,showTotal:!0,showJumper:!0,showPageSize:!0,pageSizeOptions:[15,30,50,100,200]}),p=r=>r?` / ${r}`:"",o=R([]),d=R([]),y=r=>Object.keys(r).includes("children")?"cell":"children",g=[{title:()=>a("table.port.internal_name"),dataIndex:"internal_name",slotName:"internal_name",align:"center",ellipsis:!0,tooltip:!0,bodyCellClass:y},{title:()=>a("table.proxy.port"),dataIndex:"port",slotName:"port",align:"center",ellipsis:!0,tooltip:!0,bodyCellClass:y},{title:()=>a("table.proxy.status"),dataIndex:"status",slotName:"status",align:"center",ellipsis:!0,tooltip:!0,bodyCellClass:y},{title:()=>a("table.proxy.zone_name"),dataIndex:"zone_name",slotName:"zone_name",align:"center",ellipsis:!0,tooltip:!0,bodyCellClass:y},{title:()=>a("table.proxy.position"),dataIndex:"position",slotName:"position",align:"center",ellipsis:!0,tooltip:!0,bodyCellClass:y},{title:()=>a("table.proxy.request"),dataIndex:"request",slotName:"request",align:"center",ellipsis:!0,tooltip:!0,bodyCellClass:y},{title:()=>a("table.proxy.flow"),dataIndex:"flow",slotName:"flow",align:"center",ellipsis:!0,tooltip:!0,bodyCellClass:y},{title:()=>a("table.proxy.operation"),align:"center",slotName:"oper",width:220,bodyCellClass:y}],S=R([]),_=async(r=null)=>{try{k(!0);const{data:T}=await ht({page:r,limit:e.value.pageSize}),{list:h,total:A}=T,E=[];h.forEach(P=>{P.multiply>0?E.push({...P,isLeaf:!1}):E.push({...P,isLeaf:!0})}),S.value=E,e.value.current=r,e.value.total=A}catch{}finally{k(!1)}},x=(r,T)=>{k(!0),Ut(async()=>{try{if(d.value.includes(r)){const{data:A}=await xt({pid:T.id}),E=[];A.forEach(P=>{E.push({...P,isLeaf:!0,disabled:!0})}),T.children=E}else T.children=null}catch{}finally{k(!1)}})},i=Mt({type:"checkbox",showCheckedAll:!0,onlyCurrent:!0});_(1);const b=r=>{_(r)},K=r=>{e.value.pageSize=r,_(1)},V=()=>{S.value=[],d.value=[],_(1)},j=()=>{m.value.open()},M=async r=>{try{k(!0),await bt({ids:r}),ot.success(a("table.proxy.message.success.del")),V()}catch{}finally{k(!1)}},B=async()=>{o.value.length>0&&(await M([...o.value]),o.value=[])},Q=r=>{_t.push({name:"PortSetting",query:{id:r}})},F=r=>{r.isLeaf!=!0&&Q(r.id)},Y=async r=>{var U;const h=[];let A=0;const E=async()=>{if(A<5&&h.length>0){const z=h.shift();A+=1;try{await z.fn()}catch{}A-=1,E()}},P=z=>{h.push({fn:z}),E()},Z=async z=>{try{z.status="Testing";const{data:q}=await wt({id:z.id});z.status=q.status;const{data:l}=await St({id:z.id});z.request=l.request,z.flow=l.flow}catch{r.status="Fail"}};let N=[r];((U=r==null?void 0:r.children)==null?void 0:U.length)>0&&(N=N.concat(r.children)),N.forEach(z=>{P(()=>Z(z))})},X=async()=>{o.value.length>0&&S.value.forEach(async r=>{o.value.includes(r.id)&&Y(r)})};return H({getTableData:_}),(r,T)=>{const h=Rt,A=pt,E=Dt,P=jt,Z=Ft,N=at,U=dt,z=yt,q=Bt,l=rt;return D(),J("div",oe,[c(l,null,{default:s(()=>[c(gt,{style:{"margin-bottom":"16px"}},{right:s(()=>[c(E,{content:r.$t("table.list.refresh")},{default:s(()=>[c(h,{type:"outline",shape:"circle",onClick:V},{default:s(()=>[c(U)]),_:1})]),_:1},8,["content"])]),default:s(()=>[c(N,null,{default:s(()=>[c(h,{type:"primary",shape:"round",onClick:j},{default:s(()=>[G(w(r.$t("table.port.create")),1)]),_:1}),c(E,{content:r.$t("table.port.create")},{default:s(()=>[c(h,{type:"text",onClick:X},{default:s(()=>[c(A,{size:20})]),_:1})]),_:1},8,["content"]),c(E,{content:r.$t("table.port.del")},{default:s(()=>[c(Z,{content:r.$t("table.port.confirm.del"),position:"bottom",onOk:B},{default:s(()=>[c(h,{type:"text"},{default:s(()=>[c(P,{size:20})]),_:1})]),_:1},8,["content"])]),_:1},8,["content"])]),_:1})]),_:1}),c(q,{selectedKeys:o.value,"onUpdate:selectedKeys":T[0]||(T[0]=t=>o.value=t),expandedKeys:d.value,"onUpdate:expandedKeys":T[1]||(T[1]=t=>d.value=t),loading:et(I),columns:g,data:S.value,"row-key":"id","row-selection":i,pagination:e.value,"load-more":(t,n)=>{n()},onExpand:x,onPageChange:b,onPageSizeChange:K,onCellDblclick:F},{internal_name:s(({record:t})=>[C("div",null,w(t.internal_name?t.internal_name:"--"),1)]),port:s(({record:t})=>[c(N,null,{default:s(()=>[c(E,{content:r.$t("table.list.refresh")},{default:s(()=>[c(h,{type:"text",disabled:t.status=="Testing",onClick:n=>Y(t)},{default:s(()=>[c(A)]),_:2},1032,["disabled","onClick"])]),_:2},1032,["content"]),C("div",null,[t.multiply>0?(D(),J("span",ae,w(t.port)+" ["+w(t.multiply)+"] ",1)):(D(),J("span",re,w(t.port),1))])]),_:2},1024)]),status:s(({record:t})=>[c(E,{content:t.status},{default:s(()=>[C("div",null,w(t.status?t.status:"--"),1)]),_:2},1032,["content"])]),zone_name:s(({record:t})=>[C("div",null,w(t.zone_name),1)]),position:s(({record:t})=>[C("div",null,w(!t.area&&!t.state&&!t.city?r.$t("table.port.random.pos"):t.area+p(t.state)+p(t.city)),1)]),request:s(({record:t})=>[C("div",null,w(t.request),1)]),flow:s(({record:t})=>[C("div",null,w(et(Vt)(t.flow)),1)]),oper:s(({record:t})=>[c(E,{content:r.$t("table.port.del")},{default:s(()=>[c(Z,{content:r.$t("table.port.assign.del"),onOk:n=>M([t.id])},{default:s(()=>[t.pid==0?(D(),tt(h,{key:0,type:"text"},{default:s(()=>[c(P)]),_:1})):nt("",!0)]),_:2},1032,["content","onOk"])]),_:2},1032,["content"]),c(E,{content:r.$t("table.port.setting")},{default:s(()=>[t.pid==0?(D(),tt(h,{key:0,type:"text",onClick:n=>Q(t.id)},{default:s(()=>[c(z)]),_:2},1032,["onClick"])):nt("",!0)]),_:2},1032,["content"])]),_:1},8,["selectedKeys","expandedKeys","loading","data","row-selection","pagination","load-more"])]),_:1}),c(ne,{ref_key:"formRef",ref:m,onOk:V},null,512)])}}};export{he as default};
